{% extends 'base/main.html' %} 
{% block content %}

<div class="header-bar">
    <div>
        <h1>Hello {{request.user|title}}</h1>
        <!-- <h3 style="margin:0">You have <i>{{count}}</i> incomplete task{{ count|pluralize:"s" }}</h3> -->
    </div>

    {% if request.user.is_authenticated %}
        <a href="{% url 'logout' %}">Logout</a> 
    {% else %}
        <a href="{% url 'login' %}">Login</a> 
    {% endif %}
</div>

<!-- {% if request.user.is_authenticated %}
    <p>{{request.user}}</p>
    <a href="{% url 'logout' %}">Logout</a>

{% else %}
    <a href="{% url 'login' %}">Login</a>

{% endif %} -->

<!-- <p>{{request.user}}</p>  -->

<!-- <hr>
<h1>Passwords List</h1> -->

<a href="templetes/base/sobre.html">Sobre</a><br>
<a href="templetes/base/imprimir.html">Imprimir</a><br>
<a href="templetes/base/sobre.html">Detalhes</a><br>

<div id="search-add-wrapper">
    <form action="?" method="GET" style="display: flex;">
        <input type='text' name='search_' autocomplete="off" placeholder="Search your password" value="{{ request.GET.search_}}">
        <input class="button" type="submit" value='Search'>
    </form>
    {% if passwords|length > 0 %}
    <a id="add-link" href="{% url 'password-create' %}">&#x2b;</a>
    {% endif %}
</div>


<!-- Hidden form. Form submits new item positions -->
<form style="display: none" id="reorderForm" method="post" action="{% url 'password-reorder' %}">
    {% csrf_token %}
    <input type="hidden" id="positionInput" name="position">
</form>

<!-- <form method="GET">
    <input type='text' name='search-area' placeholder="Search your password" value="{{search_input}}">
    <input class="button" type="submit" value='Search'>
</form> -->

<!-- <table>
    <tr>
        <th>Item</th>
        <th></th>
        <th></th>
    </tr>
    {% for Passwords in object_list %}
        <tr>
            <td>{{Passwords.siteTitle}}</td>

            
            <td>
                <a href="{% url 'password' Passwords.id %}">View</a>
            </td> 
            

            <td>
                <a href="{% url 'password-update' Passwords.id %}">Edit</a>
            </td>

            <td>
                <a href="{% url 'password-delete' Passwords.id %}">Delete</a>
            </td>
        </tr>
        {% empty %}
            <h3>No items in list</h3>
    {% endfor %}
</table> -->

<div id="password_list" class="password-items-wrapper">
    {% for Passwords in object_list %}
    <div class="password-wrapper" data-position="{{Password.pk}}">

        <div class="password-title">
            <a href="{% url 'password' Passwords.id %}">{{Passwords.siteTitle}}</a>
        </div>

        
        <div class="password-controls">
            <a class="update-link" href="{% url 'password-update' Passwords.id %}">&#128394;</a>
            <a class="delete-link" href="{% url 'password-delete' Passwords.id %}">&nbsp;&nbsp;&nbsp;&#215;</a>
            <span class="handle">&nbsp;&#10247;</span>
        </div>
    </div>

    {% empty %}
    <div style="text-align: center; padding-bottom: 10px; line-height: 1em;">
        <h3>No new passwords are created.</h3>
        <h3>Create a <a style="text-decoration: none; color: #e53935;" href="{% url 'password-create' %}">New password</a> ! </h3>
    </div>
    {% endfor %}



    <script>
        var passwordList = document.getElementById("passwordList");
        var reorderForm = document.getElementById("reorderForm");
        var positionInput = document.getElementById("positionInput");
    
        let sortable = Sortable.create(passwordList, {
            handle: '.handle',
            ghostClass: 'dropArea',
            chosenClass: 'selectedPassword',
    
        });
    
        function reordering() {
            const rows = document.getElementsByClassName("password-wrapper");
            let pos = [];
            for (let row of rows) {
                pos.push(row.dataset.position);
            }
            console.log(pos.join(","))
            positionInput.value = pos.join(',');
            reorderForm.submit();
        }
    
        document.ondrop = reordering
    </script>
</div>


{% endblock content %}